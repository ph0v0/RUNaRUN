# 《动感跑啊跑》需求文档

## 一、项目概述

### 1.1 项目名称
动感跑啊跑 (RUNaRUN)

### 1.2 项目简介
一款基于节奏的跑步竞技游戏，玩家需要跟随心跳节拍点击屏幕来控制角色跑步，与AI对手竞速，挑战排行榜。

### 1.3 目标平台
- 移动端网页（主要）
- PC端网页（支持）

---

## 二、核心玩法

### 2.1 节奏跑步机制
- **节拍系统**：屏幕下方显示节拍轨道，音符从右向左移动
- **点击判定**：玩家需要在音符到达中心判定线时点击
- **判定等级**：
  - **Perfect**：精准命中，距离+5米，连击+1，额外能量+2
  - **Good**：良好命中，距离+3米，连击+1，额外能量+1
  - **Miss**：失误，连击-3，无能量奖励

### 2.2 体力系统
- 初始体力：100点
- 每次跑步消耗：5点体力
- 体力不足5点时无法跑步
- 体力自动缓慢恢复（每帧+0.02）

### 2.3 能量积蓄系统
- 每次成功点击获得随机能量值（1/2/3/10/30）
- 能量目标分为三档：
  | 类型 | 所需能量 | 体力奖励 | 出现概率 |
  |------|----------|----------|----------|
  | 轻松 | 30 | +10 | 40% |
  | 标准 | 50 | +50 | 30% |
  | 快速 | 10 | +20 | 30% |
- 达成目标后自动回复体力

### 2.4 玩家状态系统
根据连击数改变玩家状态，影响节拍速度：
| 状态 | 连击阈值 | 节拍间隔 |
|------|----------|----------|
| 普通 | 0 | 850ms |
| 亢奋 | 5+ | 700ms |
| 激情 | 15+ | 500ms |

### 2.5 竞速目标
- 目标距离：800米
- 玩家需在AI对手之前到达终点

---

## 三、游戏界面

### 3.1 开始界面
- 游戏标题
- 玩家名称输入框（支持随机生成）
- 开始比赛按钮
- 排行榜入口
- 版本号显示

### 3.2 倒计时界面
- 3-2-1-开始! 倒计时动画

### 3.3 游戏主界面
- **左上角**：
  - 体力条（当前/最大值）
  - 能量积蓄条（当前/目标值 + 奖励预览）
- **右上角**：
  - 当前距离
  - 目标距离
  - 进度条
- **右侧**：
  - AI对手头像及进度
- **左侧中部**：
  - 当前状态标签
  - 连击数显示
- **底部**：
  - 节拍轨道（Good区/Perfect区/Good区）
  - 移动音符
  - 点击区域

### 3.4 结算界面
- 胜负结果
- 最终距离、最高连击、得分
- 排行榜（前10名，高亮当前玩家）
- 分享按钮
- 再来一次按钮

### 3.5 排行榜界面
- 前10名玩家排名
- 显示：排名、头像、名称、距离、最高连击、得分

---

## 四、视觉效果

### 4.1 场景元素
- **天空**：渐变背景 + 飘动云朵
- **道路**：3D透视效果，中心黄色虚线，两侧白色边线
- **树木**：道路两侧随机分布的松树，随跑步移动
- **速度线**：跑步时屏幕上的动态线条

### 4.2 第一人称视角
- 玩家手臂（随呼吸摆动）
- 跑步时的腿部动画

### 4.3 粒子效果
- Perfect：金色粒子
- Good：绿色粒子
- Miss：红色粒子
- 能量收集：闪电粒子飞向能量条

### 4.4 反馈动画
- 音符命中时放大效果
- 评级文字显示（Perfect/Good/Miss）

---

## 五、社交功能

### 5.1 玩家命名
- 支持手动输入（最长12字符）
- 支持随机生成（前缀+数字格式，如：Swift123）

### 5.2 排行榜
- 使用Firebase Firestore存储
- 排序规则：距离优先，得分次之
- 默认显示10条虚拟数据作为初始排行榜

### 5.3 分享功能
- 分享文案模板：`我是【玩家名】，我在【动感跑啊跑】里获得了【XX】分，你能超过我吗？^_^`
- 支持Web Share API
- 不支持时复制到剪贴板

---

## 六、技术实现

### 6.1 前端技术
- 纯HTML5 + CSS3 + JavaScript
- Canvas 2D渲染
- 响应式适配（基于宽度缩放）

### 6.2 后端服务
- Firebase Firestore（数据存储）
- 无需后端服务器

### 6.3 游戏画布
- 设计分辨率：1080 x 1920（竖屏）
- 自动缩放适配屏幕宽度

---

## 七、待开发功能（规划中）

### 7.1 手机适配优化
- 解决窄屏设备左右场景显示问题

### 7.2 体力回复道具
- 体力低于10时显示限量3次的汉堡道具
- 点击触发QTE玩法：6次点击吃完汉堡，回复30体力
- QTE期间暂停跑步

### 7.3 左右脚点击
- 点击区分左脚/右脚
- 更真实的跑步模拟

### 7.4 镜头效果
- 匀速跑步：轻微晃动
- 快速跑步：增强晃动
- Miss趔趄：特殊晃动
- Perfect震屏效果（待定）

### 7.5 音效系统
- 呼吸喘气声
- 脚步声
- 评级反馈音效

### 7.6 对手系统增强
- 使用真实玩家数据作为对手
- 优先使用分享者的数据

---

## 八、已知问题

### 8.1 节拍光标跳跃BUG
- 现象：节拍瞬间光标有时会突然前进一段
- 原因：状态变化时产生的时序问题
- 解决方案：状态变化延迟到下一次节拍刷新时生效

---

## 九、版本信息

- 当前版本：v1.1.1
- 版本号位置：index.html #version 元素
- 更新规则：每次提交递增第三位数字
